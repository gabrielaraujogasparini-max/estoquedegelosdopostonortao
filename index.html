<!DOCTYPE html>
<html lang="pt-BR">
<head>
<link rel="icon" href="favicon.ico">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0057b7">

<meta charset="UTF-8">
<title>Estoque de Gelos - Posto Nortão</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="icon" href="https://i.ibb.co/xSk1rq8m/Chat-GPT-Image-30-de-jan-de-2026-00-33-21.png">

<style>
body { font-family: Arial; background:#f1f4f9; margin:0; }
.container { max-width:420px; margin:auto; background:#fff; min-height:100vh; }
.topo-img { width:100%; display:block; }

.header { background:#0057b7; color:#fff; text-align:center; padding:12px; font-weight:bold; }
.header-red { background:#c40000; color:#fff; text-align:center; padding:6px; }

.content { padding:15px; }

button {
    width:100%; padding:12px; margin-top:12px;
    border:none; border-radius:6px; color:#fff;
    font-size:15px; cursor:pointer;
}
.blue { background:#0057b7; }
.red { background:#c40000; }
.gray { background:#555; }

label { font-weight:bold; display:block; margin-top:10px; }
select, input { width:100%; padding:8px; margin-top:5px; }

.estoque { text-align:center; font-size:18px; font-weight:bold; margin:10px 0; }
.info-fechamento { font-size:13px; color:#333; margin-bottom:10px; text-align:center; }

.hidden { display:none; }
.footer { text-align:center; font-size:12px; color:#666; padding:10px; }
</style>
</head>

<body>
<div class="container">

<img class="topo-img" src="https://i.ibb.co/xSk1rq8m/Chat-GPT-Image-30-de-jan-de-2026-00-33-21.png">

<div class="header">ESTOQUE DE GELOS</div>
<div class="header-red">Posto Nortão</div>

<div class="content" id="principal">

<div class="info-fechamento" id="ultimoFechamento"></div>

<div class="estoque">
Estoque Atual: <span id="estoque">0</span> gelos
</div>

<label>Frentista</label>
<select id="frentista">
<option value="">Selecione</option>
<option>Gabriel</option><option>Robson</option><option>Vinícius</option>
<option>Vitor</option><option>Alexsandro</option><option>Tainara</option>
<option>Dinho</option><option>Ana Paula</option><option>Genival</option>
<option>Hakson</option><option>Eduardo</option>
</select>

<label>Quantidade vendida</label>
<input type="number" id="qtd" min="1">

<button class="blue" onclick="darBaixa()">Dar baixa e enviar WhatsApp</button>
<button class="gray" onclick="abrirSenha()">Atualizar estoque (restrito)</button>
<button class="red" onclick="fecharTurno()">Fechar turno</button>

</div>

<div class="content hidden" id="senhaPage">
<label>Senha</label>
<input type="password" id="senha">
<button class="blue" onclick="validarSenha()">Entrar</button>
<button class="gray" onclick="voltar()">Voltar</button>
</div>

<div class="content hidden" id="estoquePage">
<label>Novo estoque total</label>
<input type="number" id="novoEstoque">
<button class="red" onclick="atualizarEstoque()">Atualizar</button>
<button class="gray" onclick="voltar()">Voltar</button>
</div>

<div class="footer">
Sistema interno • Posto Nortão<br>
Desenvolvido por Gabriel Gasparini
</div>

</div>

<script>
let estoque = Number(localStorage.getItem("estoque")) || 0;
let vendas = JSON.parse(localStorage.getItem("vendas")) || [];
let turnoAtual = Number(localStorage.getItem("turno")) || 1;
let estoqueInicialTurno = Number(localStorage.getItem("estoqueInicialTurno")) || estoque;
let ultimoFechamento = JSON.parse(localStorage.getItem("ultimoFechamento"));

document.getElementById("estoque").innerText = estoque;

if (ultimoFechamento) {
document.getElementById("ultimoFechamento").innerHTML =
`Último fechamento:<br>
${ultimoFechamento.turno}<br>
Inicial: ${ultimoFechamento.inicial} | Vendido: ${ultimoFechamento.vendido} | Final: ${ultimoFechamento.final}`;
}

function salvar() {
localStorage.setItem("estoque", estoque);
localStorage.setItem("vendas", JSON.stringify(vendas));
localStorage.setItem("turno", turnoAtual);
localStorage.setItem("estoqueInicialTurno", estoqueInicialTurno);
}

function darBaixa() {
const f = frentista.value;
const q = Number(qtd.value);
if(!f || !q || q > estoque) return alert("Dados inválidos");

estoque -= q;

const agora = new Date();
vendas.push({ frentista:f, qtd:q, hora:agora.toLocaleTimeString("pt-BR"), turno:turnoAtual });

salvar();

const msg =
`*BAIXA DE GELO*
*Frentista:* ${f}
*Quantidade:* ${q}
*Estoque atual:* ${estoque}
*Turno:* ${turnoAtual === 1 ? "Primeiro" : "Segundo"}`;

window.open("https://wa.me/?text="+encodeURIComponent(msg));
qtd.value="";
document.getElementById("estoque").innerText = estoque;
}

function fecharTurno() {
let total = vendas.reduce((s,v)=>s+v.qtd,0);

const texto =
`*FECHAMENTO ${turnoAtual === 1 ? "PRIMEIRO" : "SEGUNDO"} TURNO*
*Estoque inicial:* ${estoqueInicialTurno}
*Total vendido:* ${total}
*Estoque final:* ${estoque}`;

window.open("https://wa.me/?text="+encodeURIComponent(texto));

ultimoFechamento = {
turno: turnoAtual === 1 ? "Primeiro Turno" : "Segundo Turno",
inicial: estoqueInicialTurno,
vendido: total,
final: estoque
};

localStorage.setItem("ultimoFechamento", JSON.stringify(ultimoFechamento));

vendas = [];
turnoAtual = turnoAtual === 1 ? 2 : 1;
estoqueInicialTurno = estoque;
salvar();
location.reload();
}

function abrirSenha(){
principal.classList.add("hidden");
senhaPage.classList.remove("hidden");
}

function validarSenha(){
if(senha.value==="Nortao2025"){
senhaPage.classList.add("hidden");
estoquePage.classList.remove("hidden");
}else alert("Senha incorreta");
}

function atualizarEstoque(){
estoque = Number(novoEstoque.value);
estoqueInicialTurno = estoque;
salvar(); voltar();
document.getElementById("estoque").innerText = estoque;
}

function voltar(){
senhaPage.classList.add("hidden");
estoquePage.classList.add("hidden");
principal.classList.remove("hidden");
}
</script>

<script>
if ("serviceWorker" in navigator) {
navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>
